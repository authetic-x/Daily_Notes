# JS是如何执行的

## 变量提升

变量提升指 Javascript 在执行的过程中将变量和声明提升到代码开头部分的行为。变量被提升后会被设置为 `undefined`，如果变量和函数同名，函数的优先级更高，而且后面声明的函数也会替代前面声明的函数。



## 先编译后执行

输入一段 JS 代码，经过编译会生成两部分的内容：**执行上下文**和**可执行代码**。执行上下文是 Javascript 运行一段代码时的运行环境，比如调用一个函数就会进入这个函数的执行上下文，确定该函数在执行期间所使用的this、变量、函数等。执行上下文中有一个叫**变量环境**的对象，变量提升的内容都保存在这个对象中。

有三种情况会生成执行上下文：

1. 执行全局代码，会生成全局执行上下文
2. 执行一个函数时，会生成函数执行上下文
3. 执行 eval 函数时，eval 中的代码也会被编译，并生成执行上下文

JS 在执行的过程中会生成多个执行上下文，这些执行上下文是通过 `执行上下文栈/调用栈` 来管理的。



## 作用域

作用域是指在程序中定义变量的区域，它是变量与函数的可访问范围，其控制着变量和函数的可见性和生命周期。

ES6中存在三种类型的作用域：

1. 全局作用域
2. 函数作用域
3. 块作用域

使用 let 或 const 关键字声明的变量会创建块级作用域，这些变量不会像 var 关键字声明的变量一样被放入变量环境中，而是放在了词法环境中。

```js
function f() {
  let a = 1;
  if (1) {
    let a = 2;
    console.log(a);
  }
  console.log(a);
}
// output: 2 1
```

上面这段代码先将外面的变量 a 放入词法环境中，然后运行到 if 语句内部时，会将里面的变量 a 同样放入词法环境的一个单独的区域中，词法环境会维护一个小型的栈结构来存储这些变量，运行完代码块后再将栈里的变量弹出。这就是块级作用域的实现原理。

